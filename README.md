# 基于RAG的智能缺陷分析系统

## 项目概述
本项目是一个基于检索增强生成（RAG）技术的智能缺陷分析系统，能够通过历史缺陷案例的知识库，为新的缺陷问题提供智能化的分析和解决方案。系统利用向量检索技术实现相似案例的精准匹配，并结合大语言模型进行深度分析，提供专业的缺陷原因分析和解决方案建议。

## 系统架构

### 核心组件
1. **LLM模型服务**
   - 使用DeepSeek Reasoner模型
   - 支持流式输出和推理过程可视化
   - 提供专业的缺陷分析能力

2. **向量化引擎**
   - 采用HuggingFace的text2vec-base-chinese模型
   - 支持中文文本的高质量向量化

3. **向量存储**
   - 使用FAISS向量数据库
   - 支持高效的相似度检索

4. **知识库管理**
   - JSON格式存储历史缺陷案例
   - 支持结构化的缺陷信息管理

## 工作流程

1. **知识库初始化**
   - 加载defects_knowledge_base.json文件
   - 解析缺陷案例数据
   - 构建缺陷信息索引

2. **向量存储构建**
   - 提取缺陷标题、描述、引入阶段等信息
   - 生成文本向量表示
   - 建立向量索引

3. **缺陷分析流程**
   - 接收用户输入的缺陷描述
   - 检索相似历史案例（默认返回top3）
   - 构建分析上下文
   - 加载系统提示模板
   - 生成分析报告

4. **结果输出**
   - 展示分析推理过程
   - 提供详细的分析结果

## 配置说明

### 环境依赖
```
langchain_deepseek
langchain
faiss-cpu
torch
transformers
pandas
```

### 关键配置
1. **API配置**
   ```python
   llm = ChatDeepSeek(
       model="deepseek-reasoner",
       api_key="your-api-key",
       base_url="https://api.deepseek.com/v1"
   )
   ```

2. **向量模型配置**
   ```python
   embeddings = HuggingFaceEmbeddings(
       model_name='shibing624/text2vec-base-chinese'
   )
   ```

## 使用方法

1. **准备知识库**
   - 创建defects_knowledge_base.json文件
   - 按照规定格式录入历史缺陷案例

2. **配置系统提示**
   - 创建sys.md文件
   - 编写专业的分析提示模板

3. **运行系统**
   ```bash
   python defect_rag.py
   ```

4. **输入缺陷描述**
   - 在提示后输入需要分析的缺陷描述
   - 等待系统分析完成

## 数据格式说明

### 知识库格式
```json
{
    "defects": [
        {
            "id": "1",
            "defect_number": "DEF-001",
            "title": "缺陷标题",
            "defect_description": "缺陷详细描述",
            "introduction_phase": "引入阶段",
            "product_name": "产品名称"
        }
    ]
}
```

## 系统特点

1. **智能检索**
   - 基于语义的相似度匹配
   - 支持多维度的缺陷特征分析

2. **深度分析**
   - 结合历史经验的分析推理
   - 专业的解决方案建议

3. **实时反馈**
   - 流式输出分析过程
   - 清晰的推理路径展示

4. **可扩展性**
   - 支持知识库动态更新
   - 灵活的系统提示定制

## 注意事项

1. 确保知识库文件格式正确
2. 系统提示文件对分析质量有重要影响
3. 输入的缺陷描述应尽可能详细和准确
4. 需要稳定的网络连接以访问API服务

## 优化建议

1. 定期更新和维护知识库
2. 根据实际应用场景优化系统提示
3. 适当调整相似案例的返回数量
4. 持续收集用户反馈改进系统